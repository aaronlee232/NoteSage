// Next.js API route support: https://nextjs.org/docs/api-routes/introduction
import { supabase } from '@/scripts/supabase'
import type { NextApiRequest, NextApiResponse } from 'next'

const chat_id = 1
const embedding = [
  -0.07367987, 0.064100996, -0.042705823, 0.0007867117, 0.0065854657,
  -0.020209122, 0.016496543, 0.025237454, 0.003262748, 0.0038793066,
  0.014316006, -0.004128907, 0.010781314, -0.041234054, -0.008362485,
  0.04448024, -0.075405955, -0.04171732, -0.024728497, -0.018196953,
  0.002361517, 0.019337645, -0.024965098, -0.0016856869, 0.082431674,
  0.07162292, -0.021156883, -0.0033527305, -0.035248324, 0.0133844055,
  0.04496637, -0.0043561663, 0.003250349, 0.030599266, 0.0025855259,
  -0.047737528, 0.008423228, -0.015290691, 0.05601697, -0.04891961,
  -0.008690088, -0.020254178, -0.00068362115, -0.011439489, -0.00453488,
  -0.036111165, -0.059666272, -0.062398024, -0.00019215344, -0.0037487636,
  -0.06503507, -0.08879059, -0.07904468, 0.016003456, 0.005950775, 0.078558594,
  -0.0056340215, -0.03940889, 0.09180389, 0.028707767, 0.034893602, 0.019710582,
  -0.05425665, 0.07562959, 0.011172712, -0.0036440948, -0.03350172, 0.034458943,
  0.0054888153, 0.009723329, -0.03834022, -0.0138184205, 0.013750338,
  -0.016020313, -0.03360134, -0.11856192, -0.094940774, 0.041081153,
  -0.009788994, -0.059047423, -0.0012036909, -0.032302227, 0.008937476,
  0.10584117, 0.036227226, 0.05871476, -0.016470542, -0.06893863, -0.006853946,
  -0.0682062, -0.00092392106, -0.14253551, 0.04267676, 0.029822856, -0.14060695,
  0.023336055, -0.0038031817, -0.07798103, -0.02019309, 0.13375835,
  0.0007688803, -0.02488689, 0.07458947, -0.024783438, -0.015481136,
  0.015781311, 0.04991868, 0.021274269, -0.044371825, -0.01672532, -0.009152677,
  0.0071381754, -0.07013195, -0.03333894, -0.009636817, -0.010241696, 0.0611999,
  -0.010772319, 0.097592935, 0.090618044, 0.025587402, 0.023253419, -0.14588852,
  -0.119996436, -0.06103227, 0.008147687, 1.7718197e-5, 2.8643131e-33,
  0.07271449, -0.06984151, -0.0043865214, 0.012164969, 0.09008665, 0.019320998,
  -0.04742091, -0.06118406, -0.0863628, 0.033685923, 0.100056596, -0.03553645,
  -0.06490067, 0.07175587, 0.012840261, -0.10175452, 0.028943677, 0.023421785,
  -0.012338018, -0.037732307, -0.058650084, 0.00074670033, 0.0010186125,
  -0.0067197033, 0.121505104, 0.076829836, 0.029353244, 0.021298818,
  -0.022446413, 0.028154755, 0.023486352, -0.006272826, -0.021419084,
  -0.046927933, -0.035799116, 0.05670077, -0.035168093, -0.02267198,
  0.065448195, -0.090211116, -0.07589181, -0.09278485, -0.09351773, -0.11411129,
  0.06898557, 0.01701078, -0.018267391, 0.060285088, 0.010880261, -0.029951762,
  -0.06371301, -0.040986937, -0.0072201174, -0.018771201, -0.021966986,
  -0.0405603, -0.030649733, 0.10959879, -0.018167382, 0.030960111, -0.0958517,
  0.043678634, -0.00373352, 0.022158189, -0.010560103, 0.045508206, 0.09606241,
  0.03182951, 0.016508654, -0.023435459, -0.083882585, -0.046759248,
  0.041882485, 0.03295344, 0.0110832285, 0.0022606587, -0.085482344,
  -0.11286282, -0.029908443, -0.047511753, -0.0779722, -0.11808369,
  -0.012044485, 0.025243428, 0.023142125, -0.029657694, -0.026645396,
  -0.082514025, 0.031345755, -0.029679121, -0.093410246, -0.025695123,
  -0.00036741525, -0.032384437, -0.08858639, -6.9997625e-33, 0.1700564,
  0.033482645, -0.045540344, 0.034697667, 0.03487945, 0.06409364, 0.013328197,
  0.083318435, -0.025420891, 0.031357158, 0.02349128, 0.08754524, -0.07180007,
  0.022670006, 0.043729864, 0.036957327, 0.008588552, 0.004049751,
  -0.0029805053, -0.041155357, -0.015751932, -0.017686939, -0.031876016,
  0.059023395, 0.053800188, -0.018369079, 0.03605565, 0.009330067, 0.032706708,
  0.005688283, -0.044571556, -0.028094992, -0.037497293, 0.028988974,
  0.047056716, -0.034573033, 0.04786825, 0.05080664, 0.021527616, 0.020500688,
  0.016834695, 0.037432626, 0.13241997, 0.005126009, 0.010413576, -0.013853505,
  -0.022904463, 0.002851558, -0.08826108, -0.022192014, 0.02966064,
  -0.065182835, -0.03412857, -0.037796814, -0.05877937, -0.019422965,
  0.015290322, 0.030669272, -0.06650884, -0.057394896, -0.01653832,
  -0.050977834, -0.009095476, 0.007604862, 0.038893845, -0.090259165,
  -0.081109494, 0.03961328, -0.072594866, -0.08775532, 0.09861892, 0.050538447,
  -0.035700444, -0.02238091, -0.018764338, -0.05881128, 0.10353032, 0.010616179,
  0.017875316, 0.012700731, 0.12603204, 0.0054936255, 0.027767483, -0.019403875,
  -0.048268065, -0.00022920356, -0.03329672, 0.057131607, -0.030397365,
  -0.07649253, -0.066120364, 0.052036557, 0.10144501, 0.041122332, -0.028881604,
  -5.8008645e-8, -0.034772214, 0.0097107235, -0.0535266, -0.024487246,
  -0.017064946, 0.047983784, 0.0229179, 0.04013165, -0.012641389, -0.0064210524,
  0.103058666, 0.0034434202, -0.024432248, 0.07162644, -0.04716448, 0.059757125,
  -0.053224865, 0.068137646, 0.00084060425, -0.053860683, 0.08487792,
  0.012206745, 0.022832291, -0.004585382, 0.048152514, 0.010908538, -0.06995619,
  0.060476497, 0.016385311, 0.03559313, 0.017959604, 0.061537303, 0.01993084,
  -0.037910454, -0.0144286305, -0.007683958, 0.044119902, -0.01962026,
  0.029698461, -0.03988656, 0.014671479, -0.025295459, -0.035408955,
  -0.016749874, -0.03805361, -0.012718899, 0.04192033, 0.07191854, -0.012702652,
  -0.031646945, -0.028981172, -0.032917086, 0.036972128, -0.043819387,
  -0.092371516, 0.0979289, -0.015565222, 0.01284898, 0.05071436, 0.008480741,
  0.10231792, 0.109263785, -0.009808517, 0.023389213,
]
const recent_cutoff = 10
const match_threshold = 0.3
const match_count = 10
const min_content_length = 0

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const { error, data } = await supabase.rpc('match_messages_in_chat', {
    chat_id,
    embedding,
    recent_cutoff,
    match_threshold,
    match_count,
    min_content_length,
  })

  if (error) {
    throw error
  }

  res.status(200).json({ data })
}
